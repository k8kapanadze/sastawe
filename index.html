<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Res Photo Vault</title>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen font-sans">

    <div class="max-w-5xl mx-auto py-10 px-4">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2">ჩემი ფოტო გალერეა</h1>
            <p class="text-gray-600">ორიგინალი ხარისხის შენარჩუნებით</p>
        </header>

        <div class="flex justify-center mb-10">
            <button id="upload_widget" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all transform hover:scale-105">
                + ფოტოს დამატება
            </button>
        </div>

        <div id="gallery" class="columns-1 sm:columns-2 lg:columns-3 gap-4 space-y-4">
            </div>
    </div>

    <script>
        // ჩაწერე შენი მონაცემები აქ:
        const CLOUD_NAME = "djdz4uygc";
        const UPLOAD_PRESET = "sastawe";

        const gallery = document.getElementById('gallery');

        const myWidget = cloudinary.createUploadWidget({
            cloudName: CLOUD_NAME, 
            uploadPreset: UPLOAD_PRESET,
            clientAllowedFormats: ["jpg", "png", "jpeg", "heic"],
            maxFileSize: 20000000, // 20MB-მდე
            quality: "original", // არ აკუმშავს ფოტოს
            sources: ["local", "camera", "google_drive"]
        }, (error, result) => { 
            if (!error && result && result.event === "success") { 
                console.log('ფოტო აიტვირთა:', result.info);
                renderImage(result.info.secure_url, result.info.public_id);
            }
        });

        document.getElementById("upload_widget").addEventListener("click", () => myWidget.open(), false);

        function renderImage(url, id) {
            const div = document.createElement('div');
            div.className = "relative group break-inside-avoid bg-white p-2 rounded-xl shadow-sm border border-gray-200";
            
            // ვქმნით სურათს და გადმოწერის ღილაკს
            div.innerHTML = `
                <img src="${url}" class="w-full rounded-lg shadow-inner">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all flex items-center justify-center rounded-lg">
                    <button onclick="downloadOriginal('${url}')" class="opacity-0 group-hover:opacity-100 bg-white text-black px-4 py-2 rounded-md font-medium text-sm shadow-md transition-opacity">
                        გადმოწერა
                    </button>
                </div>
            `;
            gallery.prepend(div);
        }

        async function downloadOriginal(url) {
            const response = await fetch(url);
            const blob = await response.blob();
            const blobUrl = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = blobUrl;
            a.download = `photo_${Date.now()}.jpg`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
